---
import BaseHead from "../components/BaseHead.astro";
import Navbar from "../components/Navbar.astro";
import Footer from "../components/Footer.astro";
import { SITE_TITLE } from "../consts";
import { getAllBlogPosts } from "../lib/contentagen";

// Test the SDK connection
let sdkStatus = "unknown";
let posts = [];
let error = null;

try {
   posts = await getAllBlogPosts();
   sdkStatus = "connected";
} catch (e) {
   sdkStatus = "error";
   error = e instanceof Error ? e.message : "Unknown error";
}
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={`SDK Demo - ${SITE_TITLE}`} description="Test ContentaGen SDK integration" />
	</head>
	<body>
		<Navbar />
		<main class="max-w-4xl mx-auto px-4 py-12">
			<div class="mb-8">
				<h1 class="text-3xl font-bold text-gray-900 dark:text-gray-100 mb-4">
					ContentaGen SDK Demo
				</h1>
				<p class="text-gray-600 dark:text-gray-400">
					Testing the SDK integration with your local server
				</p>
			</div>

			<!-- SDK Status -->
			<div class="mb-8 p-6 rounded-lg border">
				<h2 class="text-xl font-semibold mb-4">SDK Connection Status</h2>
				{sdkStatus === "connected" ? (
					<div class="flex items-center gap-2 text-green-600">
						<span class="w-3 h-3 bg-green-500 rounded-full"></span>
						<span>Connected to ContentaGen API</span>
					</div>
				) : sdkStatus === "error" ? (
					<div class="flex items-center gap-2 text-red-600">
						<span class="w-3 h-3 bg-red-500 rounded-full"></span>
						<span>Connection Error</span>
					</div>
				) : (
					<div class="flex items-center gap-2 text-yellow-600">
						<span class="w-3 h-3 bg-yellow-500 rounded-full"></span>
						<span>Unknown Status</span>
					</div>
				)}
				
				{error && (
					<div class="mt-4 p-3 bg-red-50 dark:bg-red-900/20 rounded border border-red-200 dark:border-red-800">
						<p class="text-sm text-red-700 dark:text-red-300 font-medium">Error Details:</p>
						<code class="text-xs text-red-600 dark:text-red-400 block mt-1">{error}</code>
					</div>
				)}
			</div>

			<!-- Content Preview -->
			<div class="mb-8">
				<h2 class="text-xl font-semibold mb-4">Content Preview</h2>
				{posts.length > 0 ? (
					<div class="space-y-4">
						<p class="text-green-600 dark:text-green-400">
							✅ Found {posts.length} posts via SDK
						</p>
						<div class="grid gap-4">
							{posts.slice(0, 3).map((post) => (
								<div class="p-4 border rounded-lg">
									<h3 class="font-semibold text-lg">{post.title}</h3>
									<p class="text-sm text-gray-500 mb-2">Slug: {post.slug}</p>
									<p class="text-gray-600 dark:text-gray-300 text-sm line-clamp-2">
										{post.description}
									</p>
									<a 
										href={`/sdk/${post.slug}/`} 
										class="inline-block mt-2 text-blue-600 hover:text-blue-800 text-sm"
									>
										View Post →
									</a>
								</div>
							))}
						</div>
						{posts.length > 3 && (
							<p class="text-gray-500 text-sm">
								... and {posts.length - 3} more posts
							</p>
						)}
						<div class="mt-4">
							<a 
								href="/sdk-index" 
								class="inline-block px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors"
							>
								View All Posts
							</a>
						</div>
					</div>
				) : (
					<div class="p-4 bg-gray-50 dark:bg-gray-800 rounded-lg">
						<p class="text-gray-600 dark:text-gray-400">
							No posts found. This could mean:
						</p>
						<ul class="list-disc list-inside mt-2 text-sm text-gray-500 dark:text-gray-400">
							<li>Your local server isn't running</li>
							<li>No content exists for the configured agent ID</li>
							<li>The API endpoint is unreachable</li>
						</ul>
					</div>
				)}
			</div>

			<!-- API Configuration -->
			<div class="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
				<h3 class="font-semibold text-blue-800 dark:text-blue-200 mb-2">
					Current Configuration
				</h3>
				<div class="text-sm text-blue-700 dark:text-blue-300 space-y-1">
					<p><strong>API URL:</strong> http://localhost:9876</p>
					<p><strong>Agent ID:</strong> 550e8400-e29b-41d4-a716-446655440000 (mock)</p>
					<p><strong>API Key:</strong> dev-api-key</p>
				</div>
				<p class="text-xs text-blue-600 dark:text-blue-400 mt-2">
					Update these values in src/sdk.ts and src/lib/contentagen.ts
				</p>
			</div>
		</main>
		<Footer />
	</body>
</html>
