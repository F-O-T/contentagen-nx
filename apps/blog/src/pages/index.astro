---
import { sdk, agentId } from "../contentagen";
import BaseHead from "../components/BaseHead.astro";
import Navbar from "../components/Navbar.astro";
import Footer from "../components/Footer.astro";
import FormattedDate from "../components/FormattedDate.astro";
import { SITE_DESCRIPTION, SITE_TITLE } from "../consts";
import { Image } from "astro:assets";

import type { ContentList } from "@contentagen/sdk";
const response: ContentList = await sdk.listContentByAgent({
   agentId,
   status: ["approved"],
   limit: 20,
   page: 1,
});
const posts = response.posts.sort(
   (a, b) => new Date(b.createdAt).valueOf() - new Date(a.createdAt).valueOf(),
);
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
	</head>
	<body>
		<Navbar />
		<main class="max-w-4xl mx-auto px-4 py-12">
			<section>
				<ul class="grid gap-8 md:grid-cols-2 list-none m-0 p-0">
					{
						posts.map((post, index) => (
							<li
								class={index === 0 ? "md:col-span-2 text-center" : ""}
							>
<a href={`/${post.meta.slug}/`} class="block">
  <Image
    width={720}
    height={360}
    src={post.imageUrl ?? ""}
    alt={post.meta?.title ?? ""}
    class="w-full rounded-xl mb-3 transition-shadow hover:shadow-lg aspect-video object-cover"
    format="webp"
    loading="lazy"
  />
  <h4
    class={`text-xl font-semibold leading-snug text-gray-900 dark:text-gray-100 transition-colors ${index === 0 ? "md:text-4xl" : ""}`}
  >
    {post.meta?.title ?? ""}
  </h4>
  <p class="text-sm text-gray-500">
    <FormattedDate date={post.meta?.pubDate ? new Date(post.meta.pubDate) : new Date(post.createdAt)} />
  </p>
</a>
							</li>
						))
					}
				</ul>
			</section>
		</main>
		<Footer />
	</body>
</html>
