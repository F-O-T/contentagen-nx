---
// On-demand rendering version using SDK (SSR)
import BlogPost from "../../layouts/BlogPost.astro";
import { getBlogPostBySlug } from "../../lib/contentagen";

const { slug } = Astro.params;

if (!slug) {
   return Astro.redirect("/404");
}

let post;
try {
   post = await getBlogPostBySlug(slug);
} catch (error) {
   console.error("Error fetching post:", error);
   return Astro.redirect("/404");
}

if (!post) {
   return Astro.redirect("/404");
}

// Mock frontmatter data to match BlogPost layout expectations
const frontmatter = {
   title: post.title,
   description: post.description,
   pubDate: post.pubDate,
   heroImage: post.heroImage,
   author: post.author,
};
---

<BlogPost {...frontmatter}>
   <div class="prose prose-lg dark:prose-invert max-w-none">
      <div class="mb-6 p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800">
         <p class="text-sm text-green-700 dark:text-green-300 mb-2 font-medium">
            ðŸš€ SSR Content
         </p>
         <p class="text-xs text-green-600 dark:text-green-400">
            This content is fetched on-demand using SSR via ContentaGen SDK
         </p>
      </div>
      
      <div class="whitespace-pre-wrap" set:html={post.content} />
   </div>
</BlogPost>
